<?xml version="1.0" encoding="utf-8"?>
<cruise xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="cruise-config.xsd" schemaVersion="81">
  <server artifactsdir="artifacts" purgeStart="2.0" purgeUpto="50.0" agentAutoRegisterKey="dcf16b5c94ba9fccbc428949d940cc76" commandRepositoryLocation="default" serverId="6335d7f3-5c72-410c-865a-d92067e9d693" />
  <pipelines group="porter-lab-00">
    <pipeline name="porter-lab-00-pack" template="Porter-Pack">
      <materials>
        <git url="https://github.com/adobe-platform/porter-lab.git" branch="lab-00" shallowClone="true" />
      </materials>
    </pipeline>
    <pipeline name="porter-lab-00-deploy" template="Porter-Deploy">
      <params>
        <param name="pack_pipeline">porter-lab-00-pack</param>
        <param name="porter_env">dev</param>
      </params>
      <materials>
        <pipeline pipelineName="porter-lab-00-pack" stageName="Pack" />
      </materials>
    </pipeline>
  </pipelines>
  <templates>
    <pipeline name="Porter-Deploy">
      <stage name="Provision" cleanWorkingDir="true">
        <jobs>
          <job name="Provision">
            <tasks>
              <fetchartifact pipeline="#{pack_pipeline}" stage="Pack" job="Pack" srcdir="./">
                <runif status="passed" />
              </fetchartifact>
              <exec command="ls">
                <arg>-alh</arg>
                <runif status="passed" />
              </exec>
              <exec command="chmod">
                <arg>+x</arg>
                <arg>porter</arg>
                <runif status="passed" />
              </exec>
              <exec command="./porter">
                <arg>build</arg>
                <arg>provision</arg>
                <arg>-e</arg>
                <arg>#{porter_env}</arg>
                <runif status="passed" />
              </exec>
            </tasks>
            <artifacts>
              <artifact src="**/*" />
            </artifacts>
          </job>
        </jobs>
      </stage>
      <stage name="Promote" cleanWorkingDir="true">
        <jobs>
          <job name="Promote">
            <tasks>
              <fetchartifact pipeline="" stage="Provision" job="Provision" srcdir="./">
                <runif status="passed" />
              </fetchartifact>
              <exec command="ls">
                <arg>-alh</arg>
                <runif status="passed" />
              </exec>
              <exec command="chmod">
                <arg>+x</arg>
                <arg>porter</arg>
                <runif status="passed" />
              </exec>
              <exec command="./porter">
                <arg>build</arg>
                <arg>promote</arg>
                <runif status="passed" />
              </exec>
            </tasks>
            <artifacts>
              <artifact src="**/*" />
            </artifacts>
          </job>
        </jobs>
      </stage>
      <stage name="Prune" cleanWorkingDir="true">
        <jobs>
          <job name="Prune">
            <tasks>
              <fetchartifact pipeline="" stage="Provision" job="Provision" srcdir="./">
                <runif status="passed" />
              </fetchartifact>
              <exec command="ls">
                <arg>-alh</arg>
                <runif status="passed" />
              </exec>
              <exec command="chmod">
                <arg>+x</arg>
                <arg>porter</arg>
                <runif status="passed" />
              </exec>
              <exec command="./porter">
                <arg>build</arg>
                <arg>prune</arg>
                <arg>-e</arg>
                <arg>#{porter_env}</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="Porter-Pack">
      <stage name="Pack" cleanWorkingDir="true">
        <jobs>
          <job name="Pack">
            <tasks>
              <exec command="/bin/bash">
                <arg>-c</arg>
                <arg>/usr/bin/download_porter ./.porter/config</arg>
                <runif status="passed" />
              </exec>
              <exec command="/bin/bash">
                <arg>-c</arg>
                <arg>git submodule update --init --recursive</arg>
                <runif status="passed" />
              </exec>
              <exec command="ls">
                <arg>-alh</arg>
                <runif status="passed" />
              </exec>
              <exec command="./porter">
                <arg>build</arg>
                <arg>pack</arg>
                <runif status="passed" />
              </exec>
            </tasks>
            <artifacts>
              <artifact src="**/*" />
            </artifacts>
          </job>
        </jobs>
      </stage>
    </pipeline>
  </templates>
  <agents>
    <agent hostname="ip-10-24-25-7" ipaddress="10.24.25.7" uuid="b835d36a-1d82-467a-88c9-0e4174378311" />
  </agents>
</cruise>

